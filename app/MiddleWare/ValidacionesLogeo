<?php

use GuzzleHttp\Psr7\Response;
use Slim\Psr7\Response as ResponseMW;

class ValidacionesLogueo{

    public static function ValidarLogin( $request, $handler ){
        $response = new ResponseMW();
        $cuerpoSolicitud = $request->getParsedBody();

        if ( trim( $cuerpoSolicitud['email'] ) == false ) {
            $response->getBody()->write(json_encode(['mensaje' => 'Ingresar un correo', 'faltante' => 'email']));
        } else {
            if ( trim( $cuerpoSolicitud['clave'] ) == false ) {
                $response->getBody()->write(json_encode(['mensaje' => 'Ingresar clave', 'faltante' => 'puesto']));
            } else {
                $response = $handler->handle( $request );
            }
        }
        return $response;
    }

    public static function ValidarCredenciales( $request, $handler ){
        include_once "../Clases/ManejoDB.php";

        $response = new ResponseMW();
        $objetoPdo = ManejoDB::CrearAcceso();
        $consulta = $objetoPdo->RetornarConsulta( "SELECT * FROM usuarios" );
        $usuarios = $consulta->fetchAll( PDO::FETCH_OBJ );
        foreach( $usuarios as $usr ){
            if( $usr->email == $email){
                if( $usr->clave = $clave ){
                    $response = $handler->handle( $request );
                } else {
                    $response->getBody()->write( json_encode(['mensaje' => 'ContraseÃ±a incorrecta']));
                }
                break;
            } else {
                $response->getBody()->write( json_encode(['mensaje' => 'Email no registrado']));
            }
        }
        return $response;
    }
}